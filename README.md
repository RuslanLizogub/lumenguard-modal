# LUMENGUARD-MODAL

LUMENGUARD-MODAL ‚Äî —Å–µ—Ä–≤—ñ—Å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ IP (–∞–±–æ –ø–æ—Ä—Ç—É –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ñ) –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏ —É Telegram –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞–Ω—É.

## –©–æ –≤–º—ñ—î –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫

- –ü–µ—Ä–µ–≤—ñ—Ä—è—î TCP-–¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —Ü—ñ–ª—ñ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω.
- –ü–æ—Ä—ñ–≤–Ω—é—î –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —ñ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º (`online` / `offline`).
- –†–∞—Ö—É—î —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É (–ª–∏—à–µ –≥–æ–¥–∏–Ω–∏ —Ç–∞ —Ö–≤–∏–ª–∏–Ω–∏).
- –ù–∞–¥—Å–∏–ª–∞—î —É–∫—Ä–∞—ó–Ω–æ–º–æ–≤–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram —É –Ω–∞–æ—á–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ.
- –ü—Ä–∞—Ü—é—î –∑ –∫—ñ–ª—å–∫–æ–º–∞ —Ü—ñ–ª—è–º–∏ (`MONITOR_CONFIG` ‚Äî –º–∞—Å–∏–≤).
- –ó–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ (`state.json`) –∞–±–æ –≤ `modal.Dict`.

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ–∫–∏

```mermaid
flowchart TD
    A["–¢–∞–π–º–µ—Ä (–∫–æ–∂–Ω—ñ 5 —Ö–≤)"] --> B["–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é"]
    B --> C["–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ IP/–ø–æ—Ä—Ç"]
    C --> D["–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∑—ñ —Å—Ç–∞–Ω–æ–º"]
    D -->|"–ë–µ–∑ –∑–º—ñ–Ω"| E["–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ü–∏–∫–ª"]
    D -->|"–°—Ç–∞–Ω –∑–º—ñ–Ω–∏–≤—Å—è"| F["–ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å"]
    F --> G["–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ UA –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"]
    G --> H["–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤ Telegram"]
    H -->|"–£—Å–ø—ñ—Ö"| I["–ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–æ–≤–∏–π —Å—Ç–∞–Ω"]
    H -->|"–ü–æ–º–∏–ª–∫–∞"| E
    I --> E
```

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```mermaid
flowchart LR
    Cron["Modal Cron (*/5 * * * *)"] --> Fn["monitor_with_modal()"]
    Fn --> Target["–†–æ—É—Ç–µ—Ä / –°—Ç–∞—Ç–∏—á–Ω–∏–π IP"]
    Fn --> Tg["Telegram Bot API"]
    Fn --> State["modal.Dict (lumenguard-state)"]
    Secret["Modal Secret (lumenguard-config)"] --> Fn
```

## –®–≤–∏–¥–∫–∏–π –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

1. –°—Ç–≤–æ—Ä–∏ `.env` –Ω–∞ –æ—Å–Ω–æ–≤—ñ `.env.example`.
2. –í—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ: `python -m pip install -e ".[dev]"`.
3. –ó–∞–ø—É—Å—Ç–∏ –æ–¥–∏–Ω —Ü–∏–∫–ª: `python main.py --once`.
4. –î–ª—è —Ç–µ—Å—Ç—É –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–º—ñ–Ω–∏ –ø–æ—Ä—Ç —É `MONITOR_CONFIG` –Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π/–¥–æ—Å—Ç—É–ø–Ω–∏–π.

## –ó–∞–ø—É—Å–∫ —É Modal

1. –°—Ç–≤–æ—Ä–∏ —Å–µ–∫—Ä–µ—Ç —ñ–∑ `.env`:
   `modal secret create lumenguard-config --from-dotenv .env --force`
2. –î–µ–ø–ª–æ–π –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É:
   `modal deploy modal_app.py`
3. –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –¥–ª—è smoke-—Ç–µ—Å—Ç—É:
   `modal run modal_app.py::monitor_with_modal`

## –ü—Ä–∏–∫–ª–∞–¥ `MONITOR_CONFIG`

```json
[
  {
    "id": "home_real",
    "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞",
    "host": "1.2.3.4",
    "port": 80,
    "chat_id": "-100123456789"
  },
  {
    "id": "garage_real",
    "name": "–ì–∞—Ä–∞–∂",
    "host": "5.6.7.8",
    "port": 443,
    "chat_id": "-100987654321"
  }
]
```

## –§–æ—Ä–º–∞—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É Telegram

```text
üü¢ –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—è
‚è∞ –ß–∞—Å –ø–æ—è–≤–∏: 21:40
‚è≥ –°–≤—ñ—Ç–ª–æ –±—É–ª–æ –≤—ñ–¥—Å—É—Ç–Ω—î 6 —Ö–≤

üî¥ –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ
‚è∞ –ß–∞—Å –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è: 21:34
‚è≥ –°–≤—ñ—Ç–ª–æ –±—É–ª–æ –ø—Ä–∏—Å—É—Ç–Ω—î 2 –≥–æ–¥ 44 —Ö–≤
```

## –ë–µ–∑–ø–µ–∫–∞

- –°–µ–∫—Ä–µ—Ç–∏ —Ç—Ä–∏–º–∞–π —Ç—ñ–ª—å–∫–∏ –≤ `.env` —Ç–∞ Modal Secrets.
- –ù–µ –∫–æ–º—ñ—Ç—å `.env`, `state.json`, –∫–µ—à—ñ —Ç–∞ —Å–ª—É–∂–±–æ–≤—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏.
- –î–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ª–∏—à–µ `.env.example` —ñ–∑ —Ñ–µ–π–∫–æ–≤–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏.
